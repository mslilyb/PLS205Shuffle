---
title: "HW5"
output: 
 html_notebook:
    toc: true
    toc_float: true
    number_sections: true
editor_options: 
  markdown: 
    wrap: 72
  chunk_output_type: inline
---

**Note:** Before submitting your document, re-run all your R code chunks
by clicking the down-arrow next to "Run" in the document's menu bar and
selecting "**Restart R and Run All Chunks**". Then click "Preview" and
go through each answer to make sure the R code and any associated output
is provided.

Necessary libraries

```{r echo = F,message=FALSE}
library(ggplot2)
library(emmeans)
library(lme4)
library(lmerTest)
library(PLS205)
library(multcomp)
```

An experiment was run to examine the combined effects of Exercise
regimes on weight loss in dogs. They hypothesized that this may depend
on diet, so used a factorial experimental design. The experiment used
four commercial dog foods (Food_A - Food_D) and three exercise regimes
(WALK: daily walking, LOW: 30 min run 2x/week, HIGH: 30 min run 6 days
per week). They recruited 96 dogs from a nearby vet clinic and assigned
each to one of the 4 food brands and one of the 3 exercise regimes.
Weights were collected at the beginning of the experiment and after 3
months. Responses were recorded as % change in weight after 3 months for
each dog.

Here are the data:

```{r}
dog_data = read.csv('dog_data.csv')
str(dog_data)
```

### 1.1

**Create the Design table for this experiment. Use `Exercise` as the
focal treatment. Explain your choices for EU and Replicate.**

| Structure     | Variable            | Type | #levels | Replicate | EU  |
|---------------|---------------------|------|---------|-----------|-----|
| Focal Trt     | Exercise            | Cat  | 3       | Food      | Dog |
| Moderator Trt | Food                | Cat  | 4       | None      | Dog |
| Combo Trt     | Excercise:Food      | Cat  | 12      | None      | Dog |
| Design        | Dog                 | Cat  | 96      |           |     |
| Response      | \% Change in Weight | Num  | 96      |           |     |

> The EU is certainly `Dog`, since that is the only part of the
> experiment that receives a single level of treatment. Food receives
> multiple levels, and exercise is the treatment.

### 1.2

**Does the data.frame need to be updated to match the design table? If
so, make necessary changes:**

```{r}
#Dogs certainly are not numbers
dog_data$Dog = as.factor(dog_data$Dog)
```

### 1.3

**Make a plot of the data, separating by focal and moderator variables
as done in lab.**

**1) Does it look like the different exercise regimes affected weight
loss differently?** Is this a question about main, specific, or
interaction effects?

**2) Does the differences among exercise regimes seem to change between
the foods?** Is this a question about main, specific, or interaction
effects?

```{r}
ggplot(dog_data,aes(x=Exercise,y=percent_change)) + 
  geom_boxplot(aes(group = interaction(Exercise,Food),color = Food))
```

> 1.  It does. If it did not, we would expect the box plots to look more
>     alike each other, but there are definitely differences between the
>     three regimes. This is a question about the interaction effects,
>     since we are comparing the response variables of two treatments to
>     see if there is a difference.
> 2.  Yes they do. While some foods have very different results across
>     different regimes, others have much less obvious differences, like
>     Food_D which looks similar across the board. This is a question
>     about interactions, comparing the combination of exercise and food
>     across different treatment levels, as opposed to specifically
>     percent change in a single Exercise:Food.

### 1.4

Write a linear model to estimate **specific effects** of exercise at
each level of food.

```{r}
#So need to drop the focal treatment... if I understand correctly. Use lm(), given no random terms in the model...

speceffectmod <- lm(percent_change ~ Food + Food:Exercise, data = dog_data)
```

### 1.5

**Compare the 3 exercise regimes for each type of food. Use
`contrasts()` to make a table of `trt.vs.ctrl` comparisons for each type
of food, using `WALK` as the control regime. Produce confidence
intervals such that the chance that ANY of the confidence intervals do
not include the true value is less than 5%.**

**Can you conclude that there are different effects of any of these 3
exercise regimes on weight gain using any of the 4 foods? Use**
$\alpha = 0.05$**.**

```{r}
meanspec_food = emmeans(speceffectmod, specs = 'Exercise', by = 'Food')

exereffect = contrast(meanspec_food, method = 'trt.vs.ctrl', ref = 'WALK', name = 'Exercise_effect')
a = 0.05
k = 8 #there's four Foods and two hypotheses for each food, so 8
level = 1-a/k
print(summary(exereffect, infer = c(T,T), level = level))
```

> Yes! We can conclude that there are differences for HIGH exercise for
> at least two foods, Food_A and Food_B.

### 1.6

**Answer the similar question using an ANOVA. Can you conclude that
there are different effects among any of these 3 exercise regimes on
weight gain using any of the 4 foods? Use** $\alpha = 0.05$**. What is
the difference between this question and the one in 1.5?**

```{r}
anovaspec = anova(speceffectmod)
print(anovaspec)
```

> Yes, we can! With `a = 0.05`, we can see that `Food:Exercise` has a
> p-value below it, so we know that the exercise regimes differ for at
> least one food type. This question doesn't indicate which of the
> regimes may be different, just that one is (so it doesn't test each
> specific effect).

### 1.7

**Did effects of changing to either HIGH or LOW exercise change among
diets?**

**Calculate interaction effects for the HIGH-WALK and LOW-WALK contrasts
across foods. Use `pairwise` contrasts for each contrast class among
foods, and adjust your confidence intervals for the number of contrast
classes.** **Use** $\alpha = 0.05$.

**Use the CLD function to group the contrasts for each food into groups
that cannot be distinguished. Again, adjust the confidence level fo the
number of contrast classes.**

Write a complete statement describing a significant interaction contrast
that you observe.

```{r}
inter_effect_mod <- lm(percent_change ~ Exercise + Food + Exercise:Food, data = dog_data)
#so we do spec effects again
meanspec_food_i = emmeans(inter_effect_mod, specs = 'Exercise', by = 'Food')

exereffect_i = contrast(meanspec_food_i, method = 'trt.vs.ctrl', ref = 'WALK', name = 'Exercise_effect')

regroup_exce = update(exereffect_i, by = 'Exercise_effect', adjust = 'none')
pairin_evsc = contrast(regroup_exce, method = 'pairwise', name = 'Food_effect_on_Exercise_effects_pairwise')

print(summary(pairin_evsc, infer = c(T,T), level = 1-a/6))

comdis = cld(pairin_evsc, alpha = 1-a/6, Letters = letters)
comdis
```

> Of all the contrasts, only two have p values that are below our chosen
> alpha, and they are both in the HIGH-WALK contrast and are when
> switching from Food A or B to D. We are unable to establish any
> difference between the effect of A to D or B to D, however the two are
> different from all other estimates in HIGH-WALK.

### 1.8

**Repeat the last question using ANOVA. Compare the minimum p-value for
the pairwise interaction contrasts and the p-value from the ANOVA.**

```{r}
print(anova(inter_effect_mod))
```

> The p-value from the anova analysis most closely matches the average
> of the two p values for A to D and B to D for HIGH-WALK. They're
> similar, relatively, and the p-value for the anova splits the
> difference between the two.
